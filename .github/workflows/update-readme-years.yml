
name: Update years of experience in README

on:
  schedule:
    - cron: "0 5 * * *"  # roda diariamente Ã s 05:00 UTC
  workflow_dispatch: {}   # permite rodar manualmente

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Compute years since start date
        id: compute
        run: |
          START_DATE="2014-01-01"
          START_YEAR=$(date -d "$START_DATE" +%Y)
          START_MD=$(date -d "$START_DATE" +%m%d)
          CUR_YEAR=$(date +%Y)
          CUR_MD=$(date +%m%d)
          YEARS=$(( CUR_YEAR - START_YEAR ))
          if [ "$CUR_MD" -lt "$START_MD" ]; then
            YEARS=$(( YEARS - 1 ))
          fi
          if [ "$YEARS" -lt 0 ]; then YEARS=0; fi
          echo "YEARS=$YEARS" >> $GITHUB_OUTPUT

      - name: Replace placeholder in README.md
        run: |
          YEARS="${{ steps.compute.outputs.YEARS }}"
          sed -i "s/<!--YEARS_OF_EXPERIENCE-->/${YEARS}/g" README.md

      - name: Commit & push if changed
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add README.md
            git commit -m "chore: update years of experience to ${{ steps.compute.outputs.YEARS }}"
            git push
                   else
            echo "No changes to commit."
